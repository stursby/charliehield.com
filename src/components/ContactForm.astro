---
const { apiKey } = Astro.props
---

<style>
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.6;
    }
  }

  @keyframes checkmark {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    50% {
      transform: scale(1.05);
      opacity: 1;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  #status {
    animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #status.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, rgba(232, 88, 12, 0.08) 0%, rgba(251, 191, 36, 0.08) 100%);
    border: 2px solid rgba(232, 88, 12, 0.3);
    border-radius: 0.75rem;
    color: rgb(251, 191, 36);
    font-weight: 600;
    letter-spacing: 0.025em;
  }

  #status.loading::before {
    content: '';
    width: 20px;
    height: 20px;
    border: 3px solid rgba(251, 191, 36, 0.2);
    border-top-color: rgb(251, 191, 36);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  #status.success {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(74, 222, 128, 0.08) 100%);
    border: 2px solid rgba(34, 197, 94, 0.4);
    border-radius: 0.75rem;
    color: rgb(74, 222, 128);
    font-weight: 600;
    letter-spacing: 0.025em;
  }

  #status.success svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    animation: checkmark 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #status.error {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(248, 113, 113, 0.08) 100%);
    border: 2px solid rgba(239, 68, 68, 0.4);
    border-radius: 0.75rem;
    color: rgb(248, 113, 113);
    font-weight: 600;
    letter-spacing: 0.025em;
  }

  #status.error svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }
</style>

<div class="max-w-[700px] mx-auto mb-[clamp(4rem,8vw,6rem)]">
  <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-8 md:p-12 border border-white/10">
    <!-- Status Message -->
    <div id="status" class="hidden"></div>

    <form
      id="contact-form"
      action="https://api.staticforms.dev/submit"
      method="POST"
      class="flex flex-col gap-6"
      aria-label="Contact form"
    >
      <input type="hidden" name="apiKey" value={apiKey} />

      <!-- Honeypot field - hidden with inline style -->
      <input type="text" name="honeypot" style="display:none" tabindex="-1" autocomplete="off" />

      <!-- NAME + EMAIL ROW -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- NAME -->
        <div class="group">
          <label
            for="name"
            class="font-sans font-bold text-xs tracking-[0.15em] uppercase text-white/60 mb-3 block transition-colors duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] group-focus-within:text-orange"
          >
            Name <span class="text-orange">*</span>
          </label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Jane Smith"
            required
            aria-required="true"
            class="w-full font-sans text-lg font-semibold py-3 px-4 bg-white/5 border-2 border-white/20 rounded-lg text-white outline-none transition-all duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] placeholder:text-white/30 hover:border-white/40 hover:bg-white/8 focus:border-orange focus:bg-white/10"
          />
        </div>

        <!-- EMAIL -->
        <div class="group">
          <label
            for="email"
            class="font-sans font-bold text-xs tracking-[0.15em] uppercase text-white/60 mb-3 block transition-colors duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] group-focus-within:text-orange"
          >
            Email <span class="text-orange">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="jane@company.com"
            required
            aria-required="true"
            class="w-full font-sans text-lg font-semibold py-3 px-4 bg-white/5 border-2 border-white/20 rounded-lg text-white outline-none transition-all duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] placeholder:text-white/30 hover:border-white/40 hover:bg-white/8 focus:border-orange focus:bg-white/10"
          />
        </div>
      </div>

      <!-- MESSAGE -->
      <div class="group">
        <label
          for="message"
          class="font-sans font-bold text-xs tracking-[0.15em] uppercase text-white/60 mb-3 block transition-colors duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] group-focus-within:text-orange"
        >
          Message <span class="text-orange">*</span>
        </label>
        <textarea
          id="message"
          name="message"
          rows="4"
          placeholder="Tell me about your project..."
          required
          aria-required="true"
          class="w-full font-sans text-lg font-medium leading-[1.5] py-3 px-4 bg-white/5 border-2 border-white/20 rounded-lg text-white outline-none transition-all duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] resize-y placeholder:text-white/30 hover:border-white/40 hover:bg-white/8 focus:border-orange focus:bg-white/10 min-h-[120px]"
        ></textarea>
      </div>

      <!-- SUBMIT BUTTON -->
      <div class="flex justify-center mt-6">
        <button
          type="submit"
          id="submit-btn"
          class="font-sans font-bold text-base tracking-[0.05em] uppercase bg-orange text-white py-4 px-10 border-2 border-orange rounded-full cursor-pointer transition-all duration-300 [transition-timing-function:cubic-bezier(0.16,1,0.3,1)] hover:brightness-90 hover:scale-[1.02] focus-visible:brightness-90 focus-visible:scale-[1.02] focus-visible:outline-2 focus-visible:outline-orange focus-visible:outline-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:brightness-100 disabled:hover:scale-100"
          aria-label="Submit contact form"
        >
          Send Message
        </button>
      </div>

      <p class="sr-only">All fields are required.</p>
    </form>
  </div>
</div>

<script>
  document.getElementById('contact-form')?.addEventListener('submit', async e => {
    e.preventDefault()
    const form = e.target as HTMLFormElement
    const formData = new FormData(form)
    const statusDiv = document.getElementById('status')
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement

    if (!statusDiv || !submitBtn) return

    // Show loading state
    statusDiv.className = 'loading'
    statusDiv.textContent = 'Sending your message...'
    submitBtn.disabled = true

    try {
      const response = await fetch('https://api.staticforms.dev/submit', {
        method: 'POST',
        body: formData
      })

      const result = await response.json()

      if (result.success) {
        statusDiv.className = 'success'
        statusDiv.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          <span>Thank you! Your message has been sent.</span>
        `
        form.reset()
        submitBtn.disabled = false

        // Auto-hide success message after 5 seconds
        setTimeout(() => {
          statusDiv.className = 'hidden'
        }, 5000)
      } else {
        statusDiv.className = 'error'
        statusDiv.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
          </svg>
          <span>Error: ${result.message || 'Please try again.'}</span>
        `
        submitBtn.disabled = false
      }
    } catch (error) {
      statusDiv.className = 'error'
      statusDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
        </svg>
        <span>An error occurred. Please try again.</span>
      `
      submitBtn.disabled = false
    }
  })
</script>
